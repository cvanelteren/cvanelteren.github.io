<!DOCTYPE html>
<!-- This site was created with Wowchemy. https://www.wowchemy.com -->
<!-- Last Published: June 24, 2023 --><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.7.0 for Hugo" />
  

  
  












  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.047268c6dd09ad74ba54a0ba71837064.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css" integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.4d5c44e775549a931ece831911e67d73.css" />

  
  
  
    <link rel="stylesheet" href="/css/wowchemy-blocks.min.9c75b36bbbcfc822506293a1489bf6fc.css" />
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/xcode-dark.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/xcode-dark.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  


























  
  
  






  <meta name="author" content="Casper van Elteren" />





  

<meta name="description" content="Table of Contents The setup Sensor data probing Prometheus Grafana The build During the COVID pandemic all of us had to work from home. The rapid change from work being at the office now being completely at home came with many challenges such as work-life balance, good ergonomics and ensuring enough exercise to keep your body (and mind) healthy." />



<link rel="alternate" hreflang="en-us" href="https://cvanelteren.github.io/post/air-quality-monitor/" />
<link rel="canonical" href="https://cvanelteren.github.io/post/air-quality-monitor/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_hu14fe9cd784e8f78598c2a5496e7ffbbf_6207_32x32_fill_lanczos_center_3.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_hu14fe9cd784e8f78598c2a5496e7ffbbf_6207_180x180_fill_lanczos_center_3.png" />

<meta name="theme-color" content="#efebda" />










  






<meta property="twitter:card" content="summary_large_image" />

  <meta property="twitter:site" content="@wowchemy" />
  <meta property="twitter:creator" content="@wowchemy" />
<meta property="twitter:image" content="https://cvanelteren.github.io/post/air-quality-monitor/featured.png" />
<meta property="og:site_name" content="Casper van Elteren" />
<meta property="og:url" content="https://cvanelteren.github.io/post/air-quality-monitor/" />
<meta property="og:title" content="Air Quality Monitor | Casper van Elteren" />
<meta property="og:description" content="Table of Contents The setup Sensor data probing Prometheus Grafana The build During the COVID pandemic all of us had to work from home. The rapid change from work being at the office now being completely at home came with many challenges such as work-life balance, good ergonomics and ensuring enough exercise to keep your body (and mind) healthy." /><meta property="og:image" content="https://cvanelteren.github.io/post/air-quality-monitor/featured.png" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2023-06-06T10:13:28&#43;02:00"
    />
  
  
    <meta property="article:modified_time" content="2023-06-06T10:13:28&#43;02:00">
  






    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cvanelteren.github.io/post/air-quality-monitor/"
  },
  "headline": "Air Quality Monitor",
  
  "image": [
    "https://cvanelteren.github.io/post/air-quality-monitor/featured.png"
  ],
  
  "datePublished": "2023-06-06T10:13:28+02:00",
  "dateModified": "2023-06-06T10:13:28+02:00",
  
  "author": {
    "@type": "Person",
    "name": "Casper van Elteren"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Casper van Elteren",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cvanelteren.github.io/media/icon_hu14fe9cd784e8f78598c2a5496e7ffbbf_6207_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "Table of Contents The setup Sensor data probing Prometheus Grafana The build During the COVID pandemic all of us had to work from home. The rapid change from work being at the office now being completely at home came with many challenges such as work-life balance, good ergonomics and ensuring enough exercise to keep your body (and mind) healthy."
}
</script>

  

  




  
  
  

  
  

  


  
  <title>Air Quality Monitor | Casper van Elteren</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="8af3803b5ae70bab899e4fe22e3c47c4" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.fe8634e7d00f14d07fb33caf14cc8e55.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Casper van Elteren</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Casper van Elteren</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#posts"><span>Posts</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#projects"><span>Projects</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#talks"><span>Talks</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#featured"><span>Publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#contact"><span>Contact</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#navigator"><span>Navigator</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article">

  






















  
  


<div class="article-container pt-3">
  <h1>Air Quality Monitor</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Jun 6, 2023
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    6 min read
  </span>
  

  
  
  
  

  
  

</div>

  





</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 360px;">
  <div style="position: relative">
    <img src="/post/air-quality-monitor/featured_hu8fe5cc4c8f8b4a169d0e42454ed9b2c4_65273_720x2500_fit_q75_h2_lanczos_3.webp" width="720" height="360" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <h1 id="table-of-contents">Table of Contents</h1>
<ol>
<li><a href="#orga01f87d">The setup</a></li>
<li><a href="#org48ccf45">Sensor data probing</a></li>
<li><a href="#org8e0fdeb">Prometheus</a></li>
<li><a href="#orgd8e3a3d">Grafana</a></li>
<li><a href="#org594a3e3">The build</a></li>
</ol>
<p>During the COVID  pandemic all of us had to  work from home.
The rapid  change from  work being at  the office  now being
completely  at  home  came  with  many  challenges  such  as
work-life  balance,  good  ergonomics  and  ensuring  enough
exercise to  keep your  body (and  mind) healthy.  One thing
that  gets less  attention is  the quality  of the  air your
breath. It  is well known  that increased levels of  C02 can
reduce <em>cognitive functioning</em>. Increase  in fine and coarse
dust particles can  lead to pulmonary issues and  so on. For
some time I wanted to get  some grip on my local air quality
but  wasn’t really  happy  with the  options  out there  for
several reasons. First, many  sensors do not offer measuring
different measures  together, for  example some  sensors may
measure  temperature   and  humidity,  but  not   fine  dust
particles or C02 (or take any combination of the 3). Second,
I want  to be  in control of  my own data;  I don’t  want an
attached online service be it free or not, I want to own and
export the  data. Third,  the air  quality monitor  needs to
connect over WiFi for easy interfacing.</p>
<p>Few weeks  ago my  interest sparked  again after  looking at
some air  filters that IKEA  offers and I  started exploring
the world of air quality monitors. I ended on a DIY solution
from a company called <a href="https://www.airgradient.com/" target="_blank" rel="noopener">AirGradient</a>. They offer a DIY solution
that measures  C02, temperature,  humidity, fine  and coarse
dust particles.  I decided  to place an  order for  PCBs and
sourced the parts (they also offer ready made units or kits).</p>
<p>The following  will describe the build,  WiFi connection and
hooking it up to prometheus on  my server to probe and store
the data (similar to <a href="https://www.jeffgeerling.com/blog/2021/airgradient-diy-air-quality-monitor-co2-pm25" target="_blank" rel="noopener">Jeff Geerling’s write-up</a>).</p>
<p>Dealing with  the different components  in this setup  was a
bit  overwhelming; it  required combining  different (very)
mature programs. Although I am not the first to trot in the
river  of home  monitoring, I  hope this  helps some  future
person (or me) navigate the space  a bit better. It is by no
means a  complete guide.  I will be  setting this  system up
with my shiny new server running TrueNAS Scale (more on that
at a different time).</p>
<p><a id="orga01f87d"></a></p>
<h1 id="the-setup">The setup</h1>
<p>The system consists of three components (<a href="#org1f1bdaa">12</a>):</p>
<ol>
<li>Airquality metrics are collected by the airgradient unit
<ol>
<li>C02</li>
<li>Temperature &amp; humidity</li>
<li>PM02 and PM10 (dust particulates)</li>
</ol>
</li>
<li>The data  is read from the airquality  monitor and pushed
to a data logger (prometheus)</li>
<li>The data is visualized as a dashboard (grafana)</li>
</ol>
<p>















<figure  id="figure-abstract-layout-of-the-different-systems-involved">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./figures/airgradient_overview.drawio.png" alt="img" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Abstract layout of the different systems involved
    </figcaption></figure>
</p>
<p><a id="org48ccf45"></a></p>
<h1 id="sensor-data-probing">Sensor data probing</h1>
<p>Airgradient provides  a github repo with  code for reporting
on the various  air quality metrics. By default  it can push
to  an external  dashboard hosted  by airgradient.  However,
since I want  to self-host, we have to edit  the code a bit.
In  order to  expose  the sensor  data, we  have  to do  two
things:</p>
<ol>
<li>Setup a server</li>
<li>Write handlers for:
<ol>
<li>Payload</li>
<li>Not handles requests</li>
</ol>
</li>
</ol>
<p>To setup  the server,  we have to  download and  include the
ESP8266  web  server to  serve  the  sensor data.  Next,  we
advertise the data  as a json file. The  following edits are
added to the code to achieve this.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">    <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="cp">#include</span> <span class="cpf">&lt;ESP8266WebServer.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="c1">// setup server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ESP8266WebServer</span> <span class="nf">server</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="nf">createPayload</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ignore data if it possess negative values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="s">&#34;{</span><span class="se">\&#34;</span><span class="s">wifi</span><span class="se">\&#34;</span><span class="s">:&#34;</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">RSSI</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">          <span class="o">+</span> <span class="p">(</span><span class="n">Co2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s">&#34;&#34;</span> <span class="o">:</span> <span class="s">&#34;, </span><span class="se">\&#34;</span><span class="s">rco2</span><span class="se">\&#34;</span><span class="s">:&#34;</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">Co2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">+</span> <span class="p">(</span><span class="n">pm25</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s">&#34;&#34;</span> <span class="o">:</span> <span class="s">&#34;, </span><span class="se">\&#34;</span><span class="s">pm02</span><span class="se">\&#34;</span><span class="s">:&#34;</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">pm25</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">+</span> <span class="p">(</span><span class="n">TVOC</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s">&#34;&#34;</span> <span class="o">:</span> <span class="s">&#34;, </span><span class="se">\&#34;</span><span class="s">tvoc_index</span><span class="se">\&#34;</span><span class="s">:&#34;</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">TVOC</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">+</span> <span class="p">(</span><span class="n">NOX</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s">&#34;&#34;</span> <span class="o">:</span> <span class="s">&#34;, </span><span class="se">\&#34;</span><span class="s">nox_index</span><span class="se">\&#34;</span><span class="s">:&#34;</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">NOX</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">+</span> <span class="s">&#34;, </span><span class="se">\&#34;</span><span class="s">atmp</span><span class="se">\&#34;</span><span class="s">:&#34;</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">+</span> <span class="p">(</span><span class="n">hum</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s">&#34;&#34;</span> <span class="o">:</span> <span class="s">&#34;, </span><span class="se">\&#34;</span><span class="s">rhum</span><span class="se">\&#34;</span><span class="s">:&#34;</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">hum</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">+</span> <span class="s">&#34;}&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">sendPayload</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">      <span class="n">String</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">createPayload</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">&#34;application/json&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">handleNotFound</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">      <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s">&#34;text/plain&#34;</span><span class="p">,</span> <span class="s">&#34;Not Found&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// setup server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="nf">setup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ... other stuff
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// setup server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&#34;/metrics&#34;</span><span class="p">,</span> <span class="n">sendPayload</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">server</span><span class="p">.</span><span class="n">onNotFound</span><span class="p">(</span><span class="n">handleNotFound</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">server</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// edit loop to process events
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="n">loop</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">server</span><span class="p">.</span><span class="n">handleClient</span><span class="p">();</span> <span class="c1">// process on events
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span></code></pre></div><p><a id="org8e0fdeb"></a></p>
<h1 id="prometheus">Prometheus</h1>
<p>For  prometheus  the  airgradient   unit  has  to  expose  a
`/metrics` url.  I modified  the airgradient code  to expose
the  sensor values  which can  then be  read by  prometheus.
Getting  prometheus installed  was easily  done through  the
TrueNAS interface, however, it was completely unclear how to
load  the metrics  into  the interface.  When prometheus  is
booted  up, you  are  greeted with  a  rather blank  looking
interface.  There  is a  command-like  prompt  that you  can
probe. I assumed initially that the interface would allow me
to point to a particular url  to fetch the data. This wasn’t
the case  (or at  least I  was not able  to figure  it out).</p>
<p>With  TrueNAS, you  can  smoothly install  apps and  quickly
toggle some  settings to configure a  package. However, when
things  become  more  involved,  I find  the  system  a  bit
limiting. For example, the  tutorials on Prometheus requires
one to edit  a config json file to setup  where it can fetch
data from.  Inside the  TrueNAS interface  there is  no such
config option  (e.g. a file  path you can give  or something
along that  order). I  was therefore  rather confused  as to
where I should edit these changes. For the time being I ran</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">    find / -name <span class="s2">&#34;prometheus.yml&#34;</span>
</span></span></code></pre></div><p>(which for me was under `/mnt/ssd-storage/ix-applications/releases/prometheus/volumes/ix<sub>volumes</sub>/config/prometheus.yml`)</p>
<p>Inside a terminal and edited  the file on my app-pool inside
TrueNAS. The config file looks as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl">    <span class="err">crape_configs:</span>
</span></span><span class="line"><span class="cl">      <span class="err">-</span> <span class="err">job_name:</span> <span class="err">&#39;airq-monitor&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="err">metrics_path:</span> <span class="err">/metrics</span>
</span></span><span class="line"><span class="cl">        <span class="err">scrape_interval:</span> <span class="mi">30</span><span class="err">s</span>
</span></span><span class="line"><span class="cl">        <span class="err">static_configs:</span>
</span></span><span class="line"><span class="cl">          <span class="err">-</span> <span class="err">targets:</span> <span class="p">[</span><span class="err">&#39;</span><span class="mf">192.168</span><span class="err">.</span><span class="mf">1.134</span><span class="err">:</span><span class="mi">8080</span><span class="err">&#39;</span><span class="p">]</span>
</span></span></code></pre></div><p>Reloading prometheus then allowed  me to probe for different
variables exposed from the sensor.</p>
<p><a id="orgd8e3a3d"></a></p>
<h1 id="grafana">Grafana</h1>
<p>At  the  time of  writing,  Grafana  is offered  on  TrueNAS
truecharts inside  the incubator  channel. However,  for the
life  of  me  I  couldn’t  get it  to  expose  the  web-api.
According to  the documentation, Grafana has  gone through a
change whereby  it first  offered as command  line interface
and server separate. The new image renderer packages the two
combined to prevent issues that were ramping up with the old
server.  Long  story  short,  in  the end  I  used  a  local
installation to  connect to  my server and  set it  up there
yielding:</p>
<p>















<figure  id="figure-pretty-sweet">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./figures/grafana_dash.png" alt="img" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Pretty sweet!
    </figcaption></figure>

In  the  future, I  will  see  if  I  can get  this  running
completely on the server but for now this suffices.</p>
<p><a id="org594a3e3"></a></p>
<h1 id="the-build">The build</h1>
<p>I  built  the  4.2  version  of the  PCB  and  followed  the
instructions  on  the  <a href="https://www.airgradient.com/open-airgradient/instructions/diy-pro-v42/#pcb" target="_blank" rel="noopener">AirGradient  website</a>.  The  soldering
involved is straight forward and  can readily be achieved by
a beginner (<a href="#org99ef021">27</a>, <a href="#orgd4b7222">28</a>).  Combined with the clear
instructions  and  photos on  their  website,  you can’t  go
wrong!</p>
<p>















<figure  id="figure-pcb-and-components-laid-out-from-left-to-right-we-see-the-screen-some-pin-headers-the-c02-sensor-the-microcontroller-temperature-sensor-and-the-dust-sensor">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./figures/airgradient_build1.jpg" alt="img" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      PCB and components laid out. From left to right we see the screen, some pin headers, the C02 sensor, the microcontroller, temperature sensor and the dust sensor.
    </figcaption></figure>
</p>
<p>















<figure  id="figure-assembled-back-view-with-working-screen-off-we-go">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./figures/airgradient_build2.jpg" alt="img" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Assembled back view with working screen. Off we go!
    </figcaption></figure>
</p>

    </div>

    







<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=Air%20Quality%20Monitor&amp;body=https%3A%2F%2Fcvanelteren.github.io%2Fpost%2Fair-quality-monitor%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fcvanelteren.github.io%2Fpost%2Fair-quality-monitor%2F&amp;title=Air&#43;Quality&#43;Monitor" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://cvanelteren.github.io"><img class="avatar mr-3 avatar-circle" src="/authors/casper-van-elteren/avatar_huf7a4b9acc98ab48e41d97955884fc455_120959_270x270_fill_q75_lanczos_center.jpg" alt="Casper van Elteren"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://cvanelteren.github.io">Casper van Elteren</a></h5>
      <h6 class="card-subtitle">Computational scientist | Data scientist | Tinkerer</h6>
      <p class="card-text">I am a computational scientist interested in data analysis, visualization and software engineering.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/casper-van-elteren-07934774/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.nl/citations?user=kbEhuPwAAAAJ&amp;hl=en" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/cvanelteren" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://stackoverflow.com/users/7343721/globaltraveler" target="_blank" rel="noopener">
        <i class="fab fa-stack-overflow"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="/cv" >
        <i class="ai ai-cv"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


















  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  
  
  

  
  
    
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    © 2023 Me. This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank">CC BY NC ND 4.0</a>
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
        <i class="fab fa-creative-commons-nc fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-nd fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.1d4346c6f7d46c340dc0a9058dd85c13.js"></script>




  

  
  

  













  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":true}</script>



  <script src="/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js" type="module"></script>









  
  


<script src="/en/js/wowchemy.min.c84202fca2a6efbbecbaf0e8358c1d51.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js" type="module"></script>


















</body>
</html>
